<section class="profile-section">
    <div class="container py-5">
        <!-- Profile Header -->
        <div class="profile-header text-center mb-5">
            <div class="profile-pic-wrapper">
                <!-- View Mode -->
                <img *ngIf="!isEditing" [src]="profile.profilePic" alt="Profile Picture" class="profile-pic" (error)="onImageError($event)">

                <!-- Edit Mode -->
                <div *ngIf="isEditing" class="profile-pic-edit">
                    <img [src]="imagePreview || profile.profilePic" alt="Profile Picture" class="profile-pic" (error)="onImageError($event)">
                    <div class="upload-overlay">
                        <label for="profilePictureInput" class="upload-btn">
                            <i class="fas fa-camera"></i>
                            <span>Change Photo</span>
                        </label>
                        <input
                            type="file"
                            id="profilePictureInput"
                            accept="image/*"
                            (change)="onFileSelected($event)"
                            style="display: none;">
                    </div>
                </div>
            </div>
            <!-- View Mode -->
            <h1 *ngIf="!isEditing" class="profile-name mt-4">{{ profile.name }}</h1>

            <!-- Edit Mode -->
            <div *ngIf="isEditing" class="mt-4">
                <input type="text" class="form-control form-control-lg text-center mx-auto" style="max-width: 400px;" [(ngModel)]="editProfile.name" placeholder="Enter your name">
            </div>
            <!-- <p class="profile-tagline">Event Enthusiast | Music Lover | Adventure Seeker</p>
            <div class="profile-stats mt-3">
                <div class="stat-item">
                    <span class="stat-number">24</span>
                    <span class="stat-label">Events Attended</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">5</span>
                    <span class="stat-label">Upcoming</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">2023</span>
                    <span class="stat-label">Member Since</span>
                </div>
            </div> -->
        </div>

        <!-- Profile Content -->
        <div class="row g-4">
            <!-- About Card -->
            <div class="col-md-6">
                <div class="profile-card">
                    <div class="card-header">
                        <h3><i class="fas fa-user me-2"></i>About Me</h3>
                    </div>
                    <div class="card-body">
                        <!-- View Mode -->
                        <div *ngIf="!isEditing">
                            <div class="info-item">
                                <i class="fas fa-envelope"></i>
                                <span>{{ profile.email }}</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-phone"></i>
                                <span>{{ profile.phone }}</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>{{ profile.location }}</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-birthday-cake"></i>
                                <span>{{ profile.birthday }}</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-heart"></i>
                                <span>{{ profile.interests }}</span>
                            </div>
                        </div>

                        <!-- Edit Mode -->
                        <div *ngIf="isEditing">
                            <div class="mb-3">
                                <label class="form-label text-muted">Email</label>
                                <input type="email" class="form-control" [(ngModel)]="editProfile.email">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted">Phone</label>
                                <input type="tel" class="form-control" [(ngModel)]="editProfile.phone">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted">Location</label>
                                <input type="text" class="form-control" [(ngModel)]="editProfile.location">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted">Birthday</label>
                                <input type="text" class="form-control" [(ngModel)]="editProfile.birthday">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted">Interests</label>
                                <input type="text" class="form-control" [(ngModel)]="editProfile.interests">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bio Card -->
            <div class="col-md-6">
                <div class="profile-card">
                    <div class="card-header">
                        <h3><i class="fas fa-quote-left me-2"></i>Bio</h3>
                    </div>
                    <div class="card-body">
                        <!-- View Mode -->
                        <p *ngIf="!isEditing" class="bio-text">{{ profile.bio }}</p>

                        <!-- Edit Mode -->
                        <div *ngIf="isEditing">
                            <textarea class="form-control" rows="4" [(ngModel)]="editProfile.bio" placeholder="Tell us about yourself..."></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Bookings Card -->
            <div class="col-12">
                <div class="profile-card">
                    <div class="card-header">
                        <h3><i class="fas fa-ticket-alt me-2"></i>Recent Bookings</h3>
                    </div>
                    <div class="card-body">
                        <!-- Loading state -->
                        <div *ngIf="!recentTickets" class="text-center py-4">
                            <i class="fas fa-spinner fa-spin fa-2x text-muted"></i>
                            <p class="text-muted mt-2">Loading tickets...</p>
                        </div>

                        <!-- No tickets state -->
                        <div *ngIf="recentTickets && recentTickets.length === 0" class="text-center py-4">
                            <i class="fas fa-ticket-alt fa-3x text-muted mb-3"></i>
                            <p class="text-muted">No bookings yet. Start exploring events!</p>
                        </div>

                        <!-- Tickets display -->
                        <div *ngIf="recentTickets && recentTickets.length > 0" class="bookings-grid">
                            <div class="booking-item" *ngFor="let ticket of recentTickets">
                                <i [class]="getEventIcon(ticket.event?.category || '') + ' booking-icon'"></i>
                                <div class="booking-details">
                                    <h5>{{ ticket.event?.category || 'Event' }}</h5>
                                    <p>{{ formatTicketDate(ticket.event?.date || ticket.event?.stDate || '') }}</p>
                                    <small class="text-muted">Ticket #{{ ticket.ticket_ID }}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="text-center mt-5">
            <button *ngIf="!isEditing" class="profile-btn primary-btn me-3" (click)="toggleEditMode()">
                <i class="fas fa-edit me-2"></i>Edit Profile
            </button>
            <button *ngIf="isEditing" class="profile-btn primary-btn me-3" (click)="saveProfile()">
                <i class="fas fa-save me-2"></i>Save Changes
            </button>
            <button *ngIf="isEditing" class="profile-btn secondary-btn me-3" (click)="cancelEdit()">
                <i class="fas fa-times me-2"></i>Cancel
            </button>
            <button class="profile-btn danger-btn" (click)="logout()">
                <i class="fas fa-sign-out-alt me-2"></i>Logout
            </button>
            <!-- <button class="profile-btn secondary-btn" (click)="viewAllBookings()">
                <i class="fas fa-calendar-alt me-2"></i>View All Bookings
            </button> -->
        </div>
    </div>
</section>
