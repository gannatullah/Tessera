<div class="my-bookings-page container py-4 my-5">
  <!-- Header -->
  <div
    class="d-flex flex-column flex-md-row align-items-md-center justify-content-between mb-4 gap-3"
  >
    <div>
      <h2 class="mb-1 my-bookings-title">My Bookings</h2>
      <p class="mb-0 text-muted">
        View and manage all your event tickets in one place.
      </p>
    </div>

    <!-- Filter Pills -->
    <div
      class="btn-group my-bookings-filters"
      role="group"
      aria-label="Booking filters"
    >
      <button
        type="button"
        class="btn btn-sm"
        [class.my-filter-active]="activeFilter === 'All'"
        (click)="setFilter('All')"
      >
        All
      </button>
      <button
        type="button"
        class="btn btn-sm"
        [class.my-filter-active]="activeFilter === 'Upcoming'"
        (click)="setFilter('Upcoming')"
      >
        Upcoming
      </button>
      <button
        type="button"
        class="btn btn-sm"
        [class.my-filter-active]="activeFilter === 'Completed'"
        (click)="setFilter('Completed')"
      >
        Completed
      </button>
      <button
        type="button"
        class="btn btn-sm"
        [class.my-filter-active]="activeFilter === 'Cancelled'"
        (click)="setFilter('Cancelled')"
      >
        Cancelled
      </button>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="row g-3 mb-4">
    <div class="col-12 col-md-4">
      <div class="summary-card card shadow-sm border-0">
        <div class="card-body d-flex flex-column">
          <span class="summary-label">Total Tickets</span>
          <span class="summary-value">{{ tickets.length }}</span>
        </div>
      </div>
    </div>
    <div class="col-6 col-md-4">
      <div class="summary-card card shadow-sm border-0">
        <div class="card-body d-flex flex-column">
          <span class="summary-label">Upcoming</span>
          <span class="summary-value">
            {{ getStatusCount("Upcoming") }}
          </span>
        </div>
      </div>
    </div>
    <div class="col-6 col-md-4">
      <div class="summary-card card shadow-sm border-0">
        <div class="card-body d-flex flex-column">
          <span class="summary-label">Completed</span>
          <span class="summary-value">
            {{ getStatusCount("Completed") }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Tickets List -->
  <div *ngIf="!isLoading && filteredTickets.length > 0; else noTickets">
    <div
      class="ticket-card card mb-3"
      *ngFor="let ticket of filteredTickets"
    >
      <div class="card-body">
        <div
          class="d-flex flex-column flex-lg-row justify-content-between gap-3"
        >
          <!-- Left: Event details -->
          <div class="d-flex flex-column flex-md-row gap-3 flex-grow-1">
            <div class="ticket-date text-center px-3 py-2">
              <div class="ticket-day">
                {{ ticket.event?.date | date : "dd" }}
              </div>
              <div class="ticket-month">
                {{ ticket.event?.date | date : "MMM" }}
              </div>
              <div class="ticket-time">
                {{ (ticket.event?.st_Date | date : "hh:mm a") || 'Time TBA' }}
              </div>
            </div>

            <div>
              <h5 class="mb-1 ticket-event-name">
                {{ ticket.event?.name || 'Event Name' }}
              </h5>
              <p class="mb-1 text-muted ticket-venue">
                {{ ticket.event?.location || 'Venue' }} Â· {{ ticket.event?.city || 'City' }}
              </p>
              <p class="mb-1 ticket-type-info">
                {{ ticket.ticketType?.name || 'Ticket Type' }}
              </p>
              <p class="mb-0 ticket-code text-muted small">
                Ticket ID: <strong>{{ ticket.ticket_ID }}</strong>
              </p>
            </div>
          </div>

          <!-- Right: Status + actions -->
          <div
            class="d-flex flex-column align-items-lg-end justify-content-between flex-shrink-0"
          >
            <div class="mb-2">
              <span
                class="badge ticket-status-badge"
                [ngClass]="{
                  'status-upcoming': getTicketStatus(ticket).toLowerCase() === 'upcoming',
                  'status-completed': getTicketStatus(ticket).toLowerCase() === 'completed',
                  'status-cancelled': getTicketStatus(ticket).toLowerCase() === 'cancelled'
                }"
              >
                {{ getTicketStatus(ticket) }}
              </span>
            </div>

            <div class="text-lg-end">
              <div class="ticket-price mb-2">
                <span class="price-label">Price</span>
                <span class="price-value">
                  {{
                    ticket.ticketType?.price | currency : "EGP" : "symbol" : "1.0-0"
                  }}
                </span>
              </div>

              <div class="btn-group">
                <button
                  class="btn btn-sm my-btn-primary"
                  (click)="onViewTicket(ticket)"
                >
                  View Ticket
                </button>
                <button
                  *ngIf="getTicketStatus(ticket).toLowerCase() === 'upcoming'"
                  class="btn btn-sm btn-outline-danger"
                  (click)="onCancelTicket(ticket)"
                >
                  Cancel
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading state -->
  <div *ngIf="isLoading" class="text-center py-5">
    <i class="fas fa-spinner fa-spin fa-3x text-muted"></i>
    <p class="text-muted mt-3">Loading your tickets...</p>
  </div>

  <!-- No tickets state -->
  <ng-template #noTickets>
    <div class="no-tickets card border-0 text-center p-4">
      <div class="card-body">
        <h5 class="mb-2">No tickets yet</h5>
        <p class="text-muted mb-3">
          You don't have any {{ activeFilter | lowercase }} tickets right now.
        </p>
        <a routerLink="/events" class="btn my-btn-primary"> Browse Events </a>
      </div>
    </div>
  </ng-template>
</div>
